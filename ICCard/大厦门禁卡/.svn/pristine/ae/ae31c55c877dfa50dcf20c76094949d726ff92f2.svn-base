<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../js/jquery.js"></script>
    <style>
        #header{
            margin-top: 30px;
            text-align: center;
        }
        #qrCode{
            margin-top: 30px;
            text-align: center;
        }
        #tips{
            border: 1px dashed gray;
            border-top: none;
            border-left: none;
            border-right: none;
            font-size: 10px;
            color: gray;
        }
        #userid{
            height: 25px;
            width: 250px;
            border-radius: 5px;
            border-top: none;
            border-left: none;
            border-right: none;
        }
        #userid:focus{
            outline:none;
        }
        #myCode{
            height: 300px;
            width: 300px;
        }
        #footer{    
            text-align: center;
        }
        #loginBtn{
            color: honeydew;
            font-weight: 500;
            background: #6293ee;
            font-size: larger;
            height:45px;
            width:200px;
            border-radius: 5px;
            border:0px;
            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
        }
        #outBtn{
            color: honeydew;
            font-weight: 500;
            margin-top: 20px;
            background: #dd4f42;
            font-size: larger;
            height:45px;
            width:200px;
            border-radius: 5px;
            border:0px;
            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
        }
    </style>
</head>
<body>
    <div id="header">
        <span>内测版本v0.3.0</span>
    </div>
    <hr/>
    <div id="qrCode">
        <input type="text" id="userid"  placeholder="请输入ID"><br/><br/>
        <span id="tips">Tips：微信扫描原二维码，划到最后就可以看到。例：4d26a208993a47a79ffcdb28b1964750</span>
        <br/>
        <img src="https://typora-imagebed.oss-cn-beijing.aliyuncs.com/img/WX.jpg" id="myCode">
    </div>
    <div id="footer">
        <input type="button" value="登录"  id="loginBtn" onclick="getInfo()">
        <input type="button" value="注销"  id="outBtn" onclick="signOut()">
    </div>
</body>
<script>
$(function(){
    // myClipPath();
    getInfo();
    setInterval(() => {
        getInfo();
    }, 3000);
})
function getInfo(){
    // 获取id值
    let userid =  $('#userid').val();
    if (!userid) {
        userid = '4d26a208993a47a79ffcdb28b1964750';
    }
    // 发送请求
    $.get(
        "https://eroad-product.com/v1/ced-wxapi/employee/getEmployeeInfo",
        {
            id:userid
        },
        function(data,status){
            console.log(data.data)
            // 防止崩溃
            if (!data.data) {
                api.toast({
                    msg:'输入ID不合法!'
                })
                return;
            }
            // 图片控件
            const img = $('#myCode');
            // 更改图片地址   随机数-> 防止走缓存
            console.log(data.data.employeeQrcodeUrl+'&t=' + Math.random())
            img.attr('src', data.data.employeeQrcodeUrl+'&t=' + Math.random())
        }
    );
}
function myClipPath(){
    var clipBoard = api.require('clipBoard');
    clipBoard.get(function(ret, err) {
        if (ret) {
            alert(JSON.stringify(ret));
        } else {
            alert(JSON.stringify(err));
        }
    });
}
function signOut(){
    api.toast({
        msg:'未实装!'
    })
}
</script>
</html>