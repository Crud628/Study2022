<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="../js/jquery.js"></script>
    <style>
        #header{
            margin-top: 30px;
            text-align: center;
        }
        #qrCode{
            margin-top: 30px;
            text-align: center;
        }
        #tips{
            font-size: 10px;
            color: gray;
        }
        #myCode{
            height: 350px;
            width: 350px;
        }
        #footer{    
            text-align: center;
        }
        #loginBtn{
            height:30px;
            width:150px;
        }
    </style>
</head>
<body>
    <div id="header">
        <h2>创业大厦门禁卡</h3>
        <span>内测版本v0.3.0</span>
    </div>
    <div id="qrCode">
        <input type="text" id="userid"  placeholder="请输入ID"><br/>
        <span id="tips">Tips：微信扫描原二维码，划到最后就可以看到。例：4d26a208993a47a79ffcdb28b1964750</span>
        <img src="https://typora-imagebed.oss-cn-beijing.aliyuncs.com/img/WX.jpg" id="myCode">
    </div>
    <div id="footer">
        <input type="button" value="登录"  id="loginBtn" onclick="getInfo()">
    </div>
</body>
<script>
$(function(){
    getInfo();
    setInterval(() => {
        getInfo();
    }, 3000);
})
function getInfo(){
    // 获取id值
    let userid =  $('#userid').val();
    if (!userid) {
        userid = '4d26a208993a47a79ffcdb28b1964750';
    }
    // 发送请求
    $.get(
        "https://eroad-product.com/v1/ced-wxapi/employee/getEmployeeInfo",
        {
            id:userid
        },
        function(data,status){
            console.log(data.data)
            if (!data.data) {
                api.toast({
                    msg:'输入ID不合法!'
                })
                return;
            }
            // 图片控件
            const img = $('#myCode');
            // 更改图片地址   随机数-> 防止走缓存
            console.log(data.data.employeeQrcodeUrl+'&t=' + Math.random())
            img.attr('src', data.data.employeeQrcodeUrl+'&t=' + Math.random())
        }
    );
}
</script>
</html>